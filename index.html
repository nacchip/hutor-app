<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram WebApp — Registration</title>

  <!-- Telegram & Lottie -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

  <style>
    :root{
      --bg: #ffffff;
      --card-bg: #f8f9fa;
      --text: #111827;
      --muted: #6b7280;
      --accent: #2f8de4;
      --accent-opaque: rgba(47,141,228,0.12);
      --button-text: #ffffff;
      --radius: 12px;
      --border: #e6e9ee;
      --select-bg: #ffffff;
      --select-text: #111827;
    }

    .tg-dark{
      --bg:#0b0d0f;
      --card-bg:#141619;
      --text:#e6edf3;
      --muted:#9aa6b2;
      --accent:#2f9bf0;
      --accent-opaque: rgba(47,155,240,0.12);
      --button-text:#ffffff;
      --border:#222629;
      --select-bg:#1c1f23;
      --select-text:#ffffff;
    }

    /* ensure full page background applies */
    html,body{
      height:100%;
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--text);
      font-family: "Inter", "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      user-select:none; /* запрет на выделение текста */
    }

    select, option, input, button {
      user-select:none;
    }

    /* center app but keep full-page background visible */
    .root-wrap{
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding-top:28px;
    }

    .app {
      width:100%;
      max-width:420px;
      padding:18px;
    }

    .card {
      background:var(--card-bg);
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow: 0 6px 18px rgba(2,6,23,0.04);
      padding:16px;
    }

    .scene { display:none; flex-direction:column; align-items:center; gap:12px; }
    .scene.active { display:flex; }

    .title { font-size:20px; font-weight:600; text-align:center; }

    .form { width:100%; display:flex; flex-direction:column; gap:10px; margin-top:6px; }

    .input {
      border-radius:10px;
      border:1px solid var(--border);
      padding:10px;
      font-size:15px;
      background:var(--select-bg);
      color:var(--select-text);
    }

    select.input option {
      background:var(--select-bg);
      color:var(--select-text);
    }

    .btn {
      width:100%;
      border:none;
      background:var(--accent);
      color:var(--button-text);
      padding:10px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      font-size:15px;
    }

    .anim-100 { width:100px; height:100px; display:flex; justify-content:center; align-items:center; margin:6px auto 0; }

    /* Banks list */
    .bank-list { width:100%; display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .bank-item {
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 10px;
      border-radius:10px;
      border:2px solid transparent; /* заранее заложена ширина рамки */
      cursor:pointer;
      user-select:none;
      transition:background-color .12s, border-color .12s, transform .06s;
      background:transparent;
    }
    .bank-item:active { transform: translateY(1px); }

    .bank-item .lottie-small { width:24px; height:24px; flex:0 0 24px; display:flex; align-items:center; justify-content:center; }
    .bank-item .label { flex:1; font-size:15px; color:var(--text); }

    /* selected visual state */
    .bank-item.selected {
      border-color:var(--accent);
      background:var(--accent-opaque);
    }

    .placeholder {
      margin-top:10px;
      border-radius:8px;
      border:1px dashed var(--border);
      padding:18px;
      color:var(--muted);
      text-align:center;
      width:100%;
    }

    @media (max-width:420px){
      .app { padding:12px; }
    }
  </style>
</head>
<body>
  <div class="root-wrap">
    <div class="app">

      <!-- Scene 1 -->
      <div id="scene-1" class="scene active card">
        <div id="anim-register" class="anim-100" aria-hidden="true"></div>
        <div id="title-1" class="title">Регистрация</div>

        <div class="form">
          <input id="lastName" class="input" placeholder="Фамилия" />
          <input id="firstName" class="input" placeholder="Имя" />
          <select id="classSelect" class="input"></select>
          <button id="next1" class="btn">Далее</button>
        </div>
      </div>

      <!-- Scene 2 -->
      <div id="scene-2" class="scene card">
        <div id="anim-bank" class="anim-100" aria-hidden="true"></div>
        <div id="title-2" class="title">Пожалуйста, выберите банки, которыми вы пользуетесь</div>

        <div id="banksList" class="bank-list" role="list"></div>

        <button id="next2" class="btn">Далее</button>
      </div>

      <!-- Scene 3 -->
      <div id="scene-3" class="scene card">
        <div id="title-3" class="title">Сцена 3</div>
        <div id="placeholder" class="placeholder">Пока что пустая сцена</div>
        <button id="sendData" class="btn">Отправить данные боту</button>
      </div>

    </div>
  </div>

<script>
  const tg = window.Telegram?.WebApp || null;
  try { tg?.expand(); } catch(e){}

  const TRANSLATIONS = {
    ru: {
      title1: "Регистрация",
      lastName: "Фамилия",
      firstName: "Имя",
      classLabel: "Класс",
      next: "Далее",
      bankPrompt: "Пожалуйста, выберите банки, которыми вы пользуетесь",
      banks: [
        {file:"sber.json", label:"Сбербанк"},
        {file:"tbank.json", label:"Т-Банк"},
        {file:"alfa.json", label:"Альфа-Банк"},
        {file:"qiwi.json", label:"QIWI"},
        {file:"yoomoney.json", label:"ЮMoney"},
        {file:"sbp.json", label:"Другое (по СБП)"}
      ],
      scene3Title: "Сцена 3",
      scene3Placeholder: "Пока что пустая сцена",
      sendData: "Отправить данные боту"
    },
    fr: {
      title1: "Inscription",
      lastName: "Nom de famille",
      firstName: "Prénom",
      classLabel: "Classe",
      next: "Suivant",
      bankPrompt: "Veuillez sélectionner les banques que vous utilisez",
      banks: [
        {file:"sber.json", label:"Sberbank"},
        {file:"tbank.json", label:"T-Bank"},
        {file:"alfa.json", label:"Alfa-Bank"},
        {file:"qiwi.json", label:"QIWI"},
        {file:"yoomoney.json", label:"YooMoney"},
        {file:"sbp.json", label:"Autre (via SBP)"}
      ],
      scene3Title: "Scène 3",
      scene3Placeholder: "Scène vide pour l'instant",
      sendData: "Envoyer les données au bot"
    },
    en: {
      title1: "Registration",
      lastName: "Last name",
      firstName: "First name",
      classLabel: "Class",
      next: "Next",
      bankPrompt: "Please select the banks you use",
      banks: [
        {file:"sber.json", label:"Sberbank"},
        {file:"tbank.json", label:"T-Bank"},
        {file:"alfa.json", label:"Alfa-Bank"},
        {file:"qiwi.json", label:"QIWI"},
        {file:"yoomoney.json", label:"YooMoney"},
        {file:"sbp.json", label:"Other (via SBP)"}
      ],
      scene3Title: "Scene 3",
      scene3Placeholder: "Empty scene for now",
      sendData: "Send data to bot"
    }
  };

  function detectLang(){
    const code = tg?.initDataUnsafe?.user?.language_code || navigator.language || 'en';
    if (code.startsWith('ru')) return 'ru';
    if (code.startsWith('fr')) return 'fr';
    return 'en';
  }
  const LANG = detectLang();
  const L = TRANSLATIONS[LANG] || TRANSLATIONS.en;

  function applyTheme(){
    const scheme = tg?.colorScheme || 'light';
    if (scheme === 'dark') document.documentElement.classList.add('tg-dark');
    else document.documentElement.classList.remove('tg-dark');
  }
  applyTheme();
  try { tg?.onEvent('themeChanged', applyTheme); } catch(e){}

  let animRegister, animBank;
  const smallAnims = [];

  function loadLottieFixed(containerId, path, autoplay = false) {
    const el = document.getElementById(containerId);
    if (!el) return null;
    el.innerHTML = '';
    const anim = lottie.loadAnimation({
      container: el,
      renderer: 'svg',
      loop: false,
      autoplay: autoplay,
      path
    });
    el.addEventListener('click', () => {
      anim.stop();
      anim.play();
    });
    return anim;
  }

  function populateTexts(){
    document.getElementById('title-1').textContent = L.title1;
    document.getElementById('title-2').textContent = L.bankPrompt;
    document.getElementById('title-3').textContent = L.scene3Title;
    document.getElementById('placeholder').textContent = L.scene3Placeholder;
    document.getElementById('next1').textContent = L.next;
    document.getElementById('next2').textContent = L.next;
    document.getElementById('sendData').textContent = L.sendData;
    document.getElementById('lastName').placeholder = L.lastName;
    document.getElementById('firstName').placeholder = L.firstName;

    const sel = document.getElementById('classSelect');
    sel.innerHTML = '';
    const placeholder = document.createElement('option');
    placeholder.value = '';
    placeholder.textContent = `${L.classLabel} →`;
    placeholder.disabled = true;
    placeholder.selected = true;
    sel.appendChild(placeholder);

    const letters = ['А','Б','В'];
    for (let i=1;i<=11;i++){
      for (let ch of letters){
        const o = document.createElement('option');
        o.value = `${i}${ch}`;
        o.textContent = `${i}${ch}`;
        sel.appendChild(o);
      }
    }
  }

  function showScene(n){
    document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
    document.getElementById('scene-' + n).classList.add('active');

    // стопим все анимации
    if (animRegister) animRegister.stop();
    if (animBank) animBank.stop();
    smallAnims.forEach(a => a.stop());

    // запускаем только нужную
    if (n === 1 && animRegister) animRegister.play();
    if (n === 2 && animBank) animBank.play();
  }

  function buildBanks(){
    const list = document.getElementById('banksList');
    list.innerHTML = '';
    L.banks.forEach((b, i) => {
      const item = document.createElement('div');
      item.className = 'bank-item';
      item.setAttribute('data-bank', b.label);

      const small = document.createElement('div');
      small.className = 'lottie-small';
      small.id = `bank-${i}`;
      const span = document.createElement('div');
      span.className = 'label';
      span.textContent = b.label;

      item.appendChild(small);
      item.appendChild(span);
      list.appendChild(item);

      const smallAnim = loadLottieFixed(small.id, b.file, false);
      smallAnims.push(smallAnim);

      item.addEventListener('click', () => {
        item.classList.toggle('selected');
        smallAnim.stop();
        smallAnim.play();
      });
    });
  }

  function collectData(){
    return {
      lastName: document.getElementById('lastName').value,
      firstName: document.getElementById('firstName').value,
      class: document.getElementById('classSelect').value,
      banks: Array.from(document.querySelectorAll('.bank-item.selected')).map(x=>x.getAttribute('data-bank')),
      lang: LANG
    };
  }

  document.addEventListener('DOMContentLoaded', () => {
    populateTexts();
    animRegister = loadLottieFixed('anim-register', 'register.json', false);
    animBank = loadLottieFixed('anim-bank', 'bank.json', false);
    buildBanks();

    showScene(1); // запускаем сцену 1 с анимацией регистрации

    document.getElementById('next1').addEventListener('click', () => showScene(2));
    document.getElementById('next2').addEventListener('click', () => showScene(3));
    document.getElementById('sendData').addEventListener('click', () => {
      const payload = collectData();
      if (tg?.sendData) tg.sendData(JSON.stringify(payload));
      else alert(JSON.stringify(payload, null, 2));
    });
  });
</script>
</body>
</html>
